# Copyright 2021 4Paradigm
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

cases:
  - id: 0
    desc: feature signature select GCFormat const
    db: db1
    sql: |
      select GCFormat(
          numeric(1),
          continuous(2),
          category(3),
          discrete("x", 1),
          binary_label(true),
          numeric(5.5),
          continuous(6.6)) as instance;
    expect:
      schema: instance:string
      data: |
        1| 1:0:1.000000 2:0:2.000000 3:2681491882390849628 4:0 5:0:5.500000 6:0:6.600000
  - id: 1
    desc: feature signature select GCFormat const no label
    db: db1
    sql: |
      select GCFormat(
          numeric(1),
          continuous(2),
          category(3, 100),
          discrete("x", 1),
          numeric(5.5),
          category(hash64("x"), 1),
          numeric(POW(10, 1000))) as instance;
    expect:
      schema: instance:string
      data: |
        | 1:0:1.000000 2:0:2.000000 3:28 4:0 5:0:5.500000 6:0 7:0:inf
  - id: 2
    desc: feature signature nagative bucket size
    db: db1
    sql: |
      select GCFormat(
          category(3, -1),
          category(3, 0)) as instance,
    expect:
      schema: instance:string
      data: |
        | 1:2681491882390849628 2:2681491882390849628
  - id: 3
    desc: feature signature GCFormat null
    db: db1
    sql: |
      select GCFormat(
          regression_label(int("notint")),
          numeric(1),
          category(int("notint")),
          category(3),
          numeric(int("notint"))) as instance;
    expect:
      schema: instance:string
      data: |
        | 1:0:1.000000 3:2681491882390849628
  - id: 4
    desc: feature signature GCFormat no feature
    db: db1
    sql: |
      select GCFormat(binary_label(true)) as instance;
    expect:
      schema: instance:string
      data: |
        1|
  # - id: 5
  #   desc: feature signature GCFormat nothing
  #   db: db1
  #   sql: |
  #     select GCFormat() as instance;
  #   expect:
  #     schema: instance:string
  #     data: |
  #       |

  - id: 6
    desc: feature signature CSV no label
    db: db1
    sql: |
      select replace(CSV(
          category(3, -1),
          category(3, 0)
      ), ",", ";") as instance,
    expect:
      schema: instance:string
      data: |
        2681491882390849628;2681491882390849628
  - id: 7
    desc: feature signature CSV null
    db: db1
    sql: |
      select replace(CSV(
          regression_label(int("notint")),
          numeric(1),
          category(int("notint")),
          category(3),
          numeric(int("notint"))
        ), ",", ";") as instance;
    expect:
      schema: instance:string
      data: |
        ;1.000000;;2681491882390849628;
  - id: 8
    desc: feature signature CSV no feature
    db: db1
    sql: |
      select CSV(binary_label(true)) as instance;
    expect:
      schema: instance:string
      data: |
        1
  # - id: 9
  #   desc: feature signature CSV nothing
  #   db: db1
  #   sql: |
  #     select CSV() as instance;
  #   expect:
  #     schema: instance:string
  #     data: |

  - id: 10
    desc: feature signature LIBSVM no label
    db: db1
    sql: |
      select LIBSVM(
          category(3, -1),
          category(3, 0)) as instance,
    expect:
      schema: instance:string
      data: |
        2681491882390849628:1 2681491882390849628:1
  - id: 11
    desc: feature signature LIBSVM null
    db: db1
    sql: |
      select LIBSVM(
          regression_label(int("notint")),
          numeric(1),
          category(int("notint")),
          category(3),
          numeric(int("notint"))) as instance;
    expect:
      schema: instance:string
      data: |
        1:1.000000 2681491882390849628:1
  - id: 12
    desc: feature signature LIBSVM no feature
    db: db1
    sql: |
      select LIBSVM(binary_label(true)) as instance;
    expect:
      schema: instance:string
      data: |
        1
  # - id: 13
  #   desc: feature signature LIBSVM nothing
  #   db: db1
  #   sql: |
  #     select LIBSVM() as instance;
  #   expect:
  #     schema: instance:string
  #     data: |

  - id: 14
    desc: feature signature select from
    db: db1
    sql: |
      SELECT GCFormat(multiclass_label(col1), numeric(int(col0)), numeric(abs(col1)), category(col6, 1)) as instance
      FROM t1;
    inputs:
      - name: t1
        schema: col0:string, col1:int32, col2:int16, col3:float, col4:double, col5:int64, col6:string
        index: index2:col2:col5
        data: |
          0, 1, 5, 1.1, 11.1, 1, 1
    expect:
      schema: instance:string
      data: |
        1| 1:0:0.000000 2:0:1.000000 3:0
  - id: 15
    desc: feature signature select GCFormat from
    mode: request-unsupport
    db: db1
    sql: |
      SELECT GCFormat(numeric(int(col0)), multiclass_label(col1), numeric(abs(col1)), category(col6, 1)) as instance
      FROM t1;
    inputs:
      - name: t1
        schema: col0:string, col1:int32, col2:int16, col3:float, col4:double, col5:int64, col6:string
        index: index2:col2:col5
        data: |
          0, 1, 5, 1.1, 11.1, 1, 1
          0, 2, 5, 2.2, 22.2, 2, 22
          1, 3, 55, 3.3, 33.3, 1, 333
          1, 4, 55, 4.4, 44.4, 2, 4444
          2, 5, 55, 5.5, 55.5, 3, aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
    expect:
      schema: instance:string
      order: instance
      data: |
        1| 1:0:0.000000 2:0:1.000000 3:0
        2| 1:0:0.000000 2:0:2.000000 3:0
        3| 1:0:1.000000 2:0:3.000000 3:0
        4| 1:0:1.000000 2:0:4.000000 3:0
        5| 1:0:2.000000 2:0:5.000000 3:0
  - id: 16
    desc: feature signature select CSV from
    mode: request-unsupport
    db: db1
    sql: |
      SELECT replace(CSV(
          numeric(int("notint")),
          multiclass_label(col1),
          numeric(abs(col1)),
          numeric(int("notint")),
          category(col6, 1)
      ), ",", ";")  as instance
      FROM t1;
    inputs:
      - name: t1
        schema: col0:string, col1:int32, col2:int16, col3:float, col4:double, col5:int64, col6:string
        index: index2:col2:col5
        data: |
          0, 1, 5, 1.1, 11.1, 1, 1
          0, 2, 5, 2.2, 22.2, 2, 22
          1, 3, 55, 3.3, 33.3, 1, 333
          1, 4, 55, 4.4, 44.4, 2, 4444
          2, 5, 55, 5.5, 55.5, 3, aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
    expect:
      schema: instance:string
      order: instance
      data: |
        ;1;1.000000;;0
        ;2;2.000000;;0
        ;3;3.000000;;0
        ;4;4.000000;;0
        ;5;5.000000;;0
  - id: 17
    desc: feature signature select LIBSVM from
    mode: request-unsupport
    db: db1
    sql: |
      SELECT LIBSVM(numeric(int(col0)), multiclass_label(col1), numeric(abs(col1)), category(col6, 1)) as instance
      FROM t1;
    inputs:
      - name: t1
        schema: col0:string, col1:int32, col2:int16, col3:float, col4:double, col5:int64, col6:string
        index: index2:col2:col5
        data: |
          0, 1, 5, 1.1, 11.1, 1, 1
          0, 2, 5, 2.2, 22.2, 2, 22
          1, 3, 55, 3.3, 33.3, 1, 333
          1, 4, 55, 4.4, 44.4, 2, 4444
          2, 5, 55, 5.5, 55.5, 3, aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
    expect:
      schema: instance:string
      order: instance
      data: |
        1 1:0.000000 2:1.000000 0:1
        2 1:0.000000 2:2.000000 0:1
        3 1:1.000000 2:3.000000 0:1
        4 1:1.000000 2:4.000000 0:1
        5 1:2.000000 2:5.000000 0:1
  - id: 18
    desc: feature signature select multi format from
    mode: request-unsupport
    db: db1
    sql: |
      SELECT GCFormat(regression_label(col1)) as col1, CSV(regression_label(col1)) as col2, LIBSVM(regression_label(col1)) as col3
      FROM t1;
    inputs:
      - name: t1
        schema: col0:string, col1:int32, col2:int16, col3:float, col4:double, col5:int64, col6:string
        index: index2:col2:col5
        data: |
          0, 1, 5, 1.1, 11.1, 1, 1
          0, 2, 5, 2.2, 22.2, 2, 22
          1, 3, 55, 3.3, 33.3, 1, 333
          1, 4, 55, 4.4, 44.4, 2, 4444
          2, 5, 55, 5.5, 55.5, 3, aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
    expect:
      schema: col1:string, col2:string, col3:string
      order: col1
      data: |
        1.000000|, 1.000000, 1.000000
        2.000000|, 2.000000, 2.000000
        3.000000|, 3.000000, 3.000000
        4.000000|, 4.000000, 4.000000
        5.000000|, 5.000000, 5.000000
  - id: 19
    desc: feature signature select from join
    mode: request-unsupport
    db: db1
    sql: |
      SELECT replace(CSV(multiclass_label(t1.col1),
          numeric(-abs(t1.col1)),
          category(t2.col6, 1)
        ), ",", ";") as instance
      FROM t1 last join t2 on t1.col1=t2.col1;
    inputs:
      - name: t1
        resource: cases/resource/simple_t1.yaml
      - name: t2
        resource: cases/resource/simple_t1.yaml
    expect:
      schema: instance:string
      order: instance
      data: |
        1;-1.000000;0
        2;-2.000000;0
        3;-3.000000;0
        4;-4.000000;0
        5;-5.000000;0
