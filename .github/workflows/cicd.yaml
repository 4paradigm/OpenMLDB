name: publish_reports


on:
  workflow_run:
    workflows: ["cpp_ut", "sql_cluster_test", "sql_sdk_test"]
    #branches: [main]
    types:
      - completed

jobs:
  publish-test-results:
    runs-on: ubuntu-latest
    # needs: ["cpp_ut", "sql_sdk_test", "sql_cluster_test"]
    # the action will only run on 4paradigm/fedb's context, not for fork repo or dependabot
    if: >
      always() && github.event_name == 'push' || (
      github.event.pull_request.head.repo.full_name == github.repository &&
      github.event.sender.login != 'dependabot[bot]' )
    steps:
      - name: Download Artifacts
        uses: actions/download-artifact@v2

      - name: Publish Linux UT Results
        uses: EnricoMi/publish-unit-test-result-action@v1
        with:
          files: linux-ut-result-*/**/*.xml
          check_name: Linux Test Report
          comment_title: Linux Test Report
